<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Guided Proof</title>
<style>
/* GLOBAL RESET & LAYOUT */
* {
    box-sizing: border-box;
}

body {
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    max-width: 600px;
    margin: 0 auto;
    padding: 1rem;
    line-height: 1.5; /* Slightly tighter line height */
    color: #1a202c;   /* Standard dark black for all text */
    background-color: #fdfdfd;
    
    /* Layout for sticky footer */
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

main {
    flex: 1;
}

h2 {
    font-size: 1.4rem;
    color: #1a202c;
    border-bottom: 2px solid #e2e8f0;
    padding-bottom: 0.5rem;
    margin-bottom: 1.25rem;
    margin-top: 0.5rem;
}

/* CARDS (Prompt, Hint, Reveal) */
.prompt, .hint, .reveal, .finished, .error {
    /* Layout */
    padding: 0.75rem 1rem;  /* Reduced padding (was 1rem) */
    margin-bottom: 0.75rem; /* Reduced spacing between boxes */
    border-radius: 6px;
    border-left-width: 5px;
    border-left-style: solid;
    
    /* Text */
    color: #1a202c; /* Uniform black text for everything */
    font-size: 1rem;
    
    /* Animation */
    animation: slideIn 0.3s ease-out;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

/* Remove default margins from paragraphs inside cards to save vertical space */
.prompt p, .hint p, .reveal p, .finished p {
    margin: 0; 
}
/* If a box has multiple paragraphs, add a small gap between them */
.prompt p + p, .hint p + p, .reveal p + p, .finished p + p {
    margin-top: 0.5rem;
}

/* SPECIFIC CARD COLORS (Background & Border only) */
.prompt {
    background-color: #ebf8ff; /* Light Blue */
    border-left-color: #3182ce;
}

.hint {
    background-color: #fffff0; /* Light Yellow */
    border-left-color: #d69e2e;
}

.reveal {
    background-color: #f0fff4; /* Light Green */
    border-left-color: #38a169;
}

.finished {
    background-color: #edf2f7; /* Grey */
    border-left-color: #718096;
    border: 1px solid #e2e8f0;
}

.error {
    background-color: #fff5f5;
    border-left-color: #e53e3e;
}

/* BUTTONS AREA */
#buttons {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #e2e8f0;
    display: flex;
    gap: 8px; 
    flex-wrap: wrap;
}

button {
    font-family: inherit;
    font-size: 1rem;
    font-weight: 600;
    padding: 0.75rem 1rem;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s;
    
    /* Mobile friendly sizing */
    flex: 1; 
    min-width: 120px; 
}

/* Button Colors */
#hint-btn {
    background-color: #ecc94b; /* Yellow button */
    color: #442a06; /* Dark text for contrast on yellow */
}
#hint-btn:hover { background-color: #d69e2e; }

#reveal-btn, .restart-btn {
    background-color: #3182ce; /* Blue button */
    color: white;
}
#reveal-btn:hover { background-color: #2b6cb0; }

button:disabled {
    background-color: #cbd5e0 !important;
    color: #718096 !important;
    cursor: not-allowed;
    opacity: 0
</style>

<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  startup: {
    typeset: false // We will handle typesetting manually
  }
};
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<main>
  <h2 id="proof-title">Loading Proof...</h2>
  
  <div id="steps-container"></div>
  
  <div id="buttons">
      <button id="hint-btn" disabled>Show Hint</button>
      <button id="reveal-btn" disabled>Reveal Step</button>
  </div>
</main>

<footer>
    <a href="index.html" class="home-link">üè† Home</a>
</footer>

<script>
// --- Configuration & Setup ---
const urlParams = new URLSearchParams(window.location.search);
const proofId = urlParams.get('id');

// Global State
let currentStep = 0;
let proofData = null;

// DOM Elements
const stepsContainer = document.getElementById("steps-container");
const hintBtn = document.getElementById("hint-btn");
const revealBtn = document.getElementById("reveal-btn");
const buttonsDiv = document.getElementById("buttons");
const titleElem = document.getElementById("proof-title");

// --- Helper: Robustly Render MathJax ---
function renderMath() {
  // Check if MathJax is loaded and the typesetPromise function is available
  if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
      MathJax.typesetPromise().catch((err) => console.log('MathJax error:', err));
  } else {
      // If MathJax isn't ready yet, wait 50ms and try again
      console.log("MathJax not ready, retrying...");
      setTimeout(renderMath, 50);
  }
}

// --- 1. Load Data ---
if (proofId) {
    fetch(`proofs/${proofId}.json`)
        .then(response => {
            if (!response.ok) throw new Error(`Proof file not found (${response.status})`);
            return response.json();
        })
        .then(data => {
            proofData = data;
            initProof();
        })
        .catch(err => {
            console.error("Load Error:", err);
            titleElem.innerText = "Error";
            stepsContainer.innerHTML = `
                <div class='error'>
                    <h3>‚ö†Ô∏è Could not load proof</h3>
                    <p>Details: ${err.message}</p>
                    <p><strong>Note:</strong> If you are opening this file directly from your folder (file://), this will not work due to browser security (CORS). You must use a local server.</p>
                </div>`;
            buttonsDiv.style.display = 'none';
        });
} else {
    titleElem.innerText = "Welcome";
    stepsContainer.innerHTML = "<p>Please select a proof from the Home Page.</p>";
    buttonsDiv.style.display = 'none';
}

// --- 2. Initialize Logic ---
function initProof() {
    titleElem.innerText = proofData.title; // Set Header Title
    revealBtn.disabled = false; // Enable 'Reveal' button
    showPrompt();
}

// --- 3. Core Functions ---
function showPrompt() {
  // Check if we have reached the end of the steps
  if (currentStep >= proofData.steps.length) {
    hintBtn.style.display = 'none';
    revealBtn.innerText = "Reveal Full Proof";
    return;
  }

  const step = proofData.steps[currentStep];
  
  // Create Prompt Element
  const promptDiv = document.createElement("div");
  promptDiv.className = "prompt";
  promptDiv.innerHTML = `<p><strong>Step ${currentStep + 1}:</strong> ${step.prompt}</p>`;
  stepsContainer.appendChild(promptDiv);
  
  // UX: Scroll and Render Math
  promptDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
  renderMath();

  // Handle Hint Button State
  if (!step.hint) {
      hintBtn.disabled = true;
  } else {
      hintBtn.disabled = false;
  }
}

hintBtn.onclick = () => {
  const step = proofData.steps[currentStep];
  if (currentStep < proofData.steps.length && step.hint) {
    const hintDiv = document.createElement("div");
    hintDiv.className = "hint";
    hintDiv.innerHTML = "<strong>Hint: </strong>" + step.hint;
    stepsContainer.appendChild(hintDiv);
    
    renderMath();
    
    hintBtn.disabled = true;
    hintDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
};

revealBtn.onclick = () => {
  // Case A: Revealing the next step
  if (currentStep < proofData.steps.length) {
    const step = proofData.steps[currentStep];
    const revealDiv = document.createElement("div");
    revealDiv.className = "reveal";
    revealDiv.innerHTML = step.reveal;
    stepsContainer.appendChild(revealDiv);
    
    renderMath();

    currentStep++;
    showPrompt(); 
  }
  // Case B: Showing the full proof summary
  else {
      const finalMsg = document.createElement("div");
      finalMsg.className = "finished";
      finalMsg.innerHTML = `<h3>${proofData.title}</h3>${proofData.fullProofHtml}`;
      stepsContainer.appendChild(finalMsg);
      
      renderMath();
      finalMsg.scrollIntoView({ behavior: 'smooth' });

      // Change interaction buttons to a Restart button
      buttonsDiv.innerHTML = `<button class="restart-btn" onclick="window.location.reload()">üîÑ Restart Proof</button>`;
  }
};
</script>
</body>
</html>